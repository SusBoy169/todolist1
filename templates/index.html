<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TaskStar Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main_style.css') }}">
</head>
<body>
    <div class="top-bar sticky">
        <div class="app-logo">TaskStar üåü</div>
        <div class="top-bar-center">
            <div id="date-display">{{ current_date_str }}</div>
            <div id="clock-display">IST Time</div>
        </div>
        <div class="top-bar-right">
            <a href="{{ url_for('dashboard') }}" class="nav-button-style" style="margin-right: 10px;">Analytics Dashboard</a>
            <div class="settings-link-container">
                 <a href="{{ url_for('settings') }}" class="nav-button-style">Settings</a>
            </div>
            {# Toggle switch removed from here #}
        </div>
    </div>

    {# Flashed messages block removed #}

    <div class="home-dashboard-container">
        {% for user_name in users %}
        <div class="user-summary-card" id="card-{{ user_name.lower() }}">
            <div class="card-header">
                <div class="avatar-placeholder" id="avatar-{{ user_name.lower() }}">
                    {{ user_name[0] }}
                </div>
                <div class="user-info">
                    <h2>{{ user_name }}</h2>
                    <p class="stars-display">‚≠ê {{ home_dashboard_data[user_name].stars }}</p>
                </div>
            </div>

            <div class="quick-summary">
                <div class="summary-bubble pending-bubble">
                    <span class="bubble-value">{{ home_dashboard_data[user_name].pending_count }}</span>
                    <span class="bubble-label">üïí Pending</span>
                </div>
                <div class="summary-bubble today-bubble">
                    <span class="bubble-value">{{ home_dashboard_data[user_name].completed_today }}</span>
                    <span class="bubble-label">‚úÖ Completed Today</span>
                </div>
                <div class="summary-bubble yesterday-bubble">
                    <span class="bubble-value">{{ home_dashboard_data[user_name].completed_yesterday }}</span>
                    <span class="bubble-label">‚èÆÔ∏è Done Yesterday</span>
                </div>
            </div>

            <div class="card-actions">
                <a href="{{ url_for('main_app_view', user=user_name) }}" class="button-style">Go to My To-Do List</a>
                <a href="{{ url_for('main_app_view', user=user_name) }}" class="button-style-secondary">View & Edit Tasks</a>
            </div>
        </div>
        {% endfor %}
    </div>

    <div style="text-align:center; margin-top: 20px; padding:10px; background-color: #eef; border-radius:5px;">
        <p id="motivationalQuote">"The journey of a thousand miles begins with one step."</p>
    </div>

    <script>
    // --- Clock Function ---
    function updateClockIST() {
        const now = new Date();
        const utcYear = now.getUTCFullYear();
        const utcMonth = now.getUTCMonth();
        const utcDate = now.getUTCDate();
        const utcHours = now.getUTCHours();
        const utcMinutes = now.getUTCMinutes();
        const utcSeconds = now.getUTCSeconds();
        const utcDateTime = new Date(Date.UTC(utcYear, utcMonth, utcDate, utcHours, utcMinutes, utcSeconds));
        utcDateTime.setHours(utcDateTime.getHours() + 5);
        utcDateTime.setMinutes(utcDateTime.getMinutes() + 30);

        const istHours = String(utcDateTime.getUTCHours()).padStart(2, '0');
        const istMinutes = String(utcDateTime.getUTCMinutes()).padStart(2, '0');
        const istSeconds = String(utcDateTime.getUTCSeconds()).padStart(2, '0');

        const timeString =
            String(istHours).padStart(2, '0') + ':' +
            String(istMinutes).padStart(2, '0') + ':' +
            String(istSeconds).padStart(2, '0') + ' IST';
        const clockElement = document.getElementById('clock-display');
        if (clockElement) clockElement.textContent = timeString;
    }

    function applyUserCustomizations() {
        const userCards = document.querySelectorAll('.user-summary-card');
        userCards.forEach(card => {
            const userId = card.id.replace('card-', ''); // e.g., "veer" from "card-veer"
            // The users array from Flask is like ["Veer", "Vardaan"]. We need to match casing or be careful.
            // Let's assume userId from card.id is lowercase.
            // We need the original username casing to match localStorage keys if they were stored with original casing.
            // However, flask_users_list in settings.html implies original casing is used for keys.
            // Let's find the original username from the h2 tag as a robust way.
            const userNameElement = card.querySelector('h2');
            if (!userNameElement) return;
            const originalUserName = userNameElement.textContent.trim(); // This is the "Veer", "Vardaan" etc.

            // 1. Update Display Name
            const storedDisplayName = localStorage.getItem(`user_${originalUserName}_displayName`);
            if (storedDisplayName) {
                userNameElement.textContent = storedDisplayName;
            }

            // 2. Update Avatar
            const storedAvatarUrl = localStorage.getItem(`user_${originalUserName}_avatarUrl`);
            const avatarPlaceholder = card.querySelector(`#avatar-${userId}`); // e.g., #avatar-veer
            if (storedAvatarUrl && avatarPlaceholder) {
                avatarPlaceholder.textContent = ''; // Clear the initial character
                const img = document.createElement('img');
                img.src = storedAvatarUrl;
                img.alt = originalUserName + "'s Avatar";
                img.style.width = '100%'; // Make image fill the placeholder
                img.style.height = '100%';
                img.style.borderRadius = '50%';
                avatarPlaceholder.appendChild(img);
            }

            // 3. Update Accent Color (applying to card background)
            const storedAccentColor = localStorage.getItem(`user_${originalUserName}_accentColor`);
            if (storedAccentColor) {
                card.style.backgroundColor = storedAccentColor;
                // May need to adjust text color for contrast if background gets too dark/light
                // For simplicity, this is omitted for now.
            }
        });
    }


    // Function to apply hover/active styles to tabs (top border highlight) - Not currently used in index.html as tabs are gone
    // function applyTabHoverAndActiveStyles() { ... }

    function initializePageFeatures() {
        console.log('[Rollback] Initializing page features for index.html.');
        updateClockIST();
        applyUserCustomizations(); // Apply customizations on load
        // Note: Tab-related logic previously here (applyTabHoverAndActiveStyles, lastActiveTabIdentifier)
        // has been removed as it's not applicable to the current index.html structure.
    }

    // Initialize features on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', function() {
        console.log('[Rollback] DOMContentLoaded event fired for index.html.');
        initializePageFeatures();

        if (!window.clockIntervalId_index) {
            window.clockIntervalId_index = setInterval(updateClockIST, 1000);
        }
    });

    // Fallback for initialization if DOM already ready
    if (document.readyState !== 'loading' && !window.pageFeaturesInitialized_index) {
        console.log('[Rollback] DOM already loaded, running init for index.html.');
        initializePageFeatures();
        if (!window.clockIntervalId_index) {
            window.clockIntervalId_index = setInterval(updateClockIST, 1000);
        }
        window.pageFeaturesInitialized_index = true;
    }
    </script>
</body>
</html>
